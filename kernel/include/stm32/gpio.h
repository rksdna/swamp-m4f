/*
 * Swamp - cooperative multitasking operating system
 * Copyright (c) 2021 rksdna
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

#ifndef GPIO_H
#define GPIO_H

#include <types.h>

struct gpio
{
    volatile u32_t MODER;
    volatile u32_t OTYPER;
    volatile u32_t OSPEEDR;
    volatile u32_t PUPDR;
    volatile u32_t IDR;
    volatile u32_t ODR;
    volatile u32_t BSRR;
    volatile u32_t LCKR;
    volatile u32_t AFRL;
    volatile u32_t AFRH;
};

#define GPIOA ((struct gpio *)0x40020000)
#define GPIOB ((struct gpio *)0x40020400)
#define GPIOC ((struct gpio *)0x40020800)
#define GPIOD ((struct gpio *)0x40020C00)
#define GPIOE ((struct gpio *)0x40021000)
#define GPIOF ((struct gpio *)0x40021400)
#define GPIOG ((struct gpio *)0x40021800)
#define GPIOH ((struct gpio *)0x40021C00)
#define GPIOI ((struct gpio *)0x40022000)
#define GPIOJ ((struct gpio *)0x40022400)
#define GPIOK ((struct gpio *)0x40022800)

#define GPIO_AFRH_AFRH0 ((u32_t)0x0000000F)
#define GPIO_AFRH_AFRH1 ((u32_t)0x000000F0)
#define GPIO_AFRH_AFRH2 ((u32_t)0x00000F00)
#define GPIO_AFRH_AFRH3 ((u32_t)0x0000F000)
#define GPIO_AFRH_AFRH4 ((u32_t)0x000F0000)
#define GPIO_AFRH_AFRH5 ((u32_t)0x00F00000)
#define GPIO_AFRH_AFRH6 ((u32_t)0x0F000000)
#define GPIO_AFRH_AFRH7 ((u32_t)0xF0000000)

#define GPIO_AFRL_AFRL0 ((u32_t)0x0000000F)
#define GPIO_AFRL_AFRL1 ((u32_t)0x000000F0)
#define GPIO_AFRL_AFRL2 ((u32_t)0x00000F00)
#define GPIO_AFRL_AFRL3 ((u32_t)0x0000F000)
#define GPIO_AFRL_AFRL4 ((u32_t)0x000F0000)
#define GPIO_AFRL_AFRL5 ((u32_t)0x00F00000)
#define GPIO_AFRL_AFRL6 ((u32_t)0x0F000000)
#define GPIO_AFRL_AFRL7 ((u32_t)0xF0000000)

#define GPIO_AFRH(pin, function) ((u32_t)function << (4 * ((pin) - 8)))
#define GPIO_AFRL(pin, function) ((u32_t)function << (4 * (pin)))

#define GPIO_BSRR_BS0 ((u32_t)0x00000001)
#define GPIO_BSRR_BS1 ((u32_t)0x00000002)
#define GPIO_BSRR_BS2 ((u32_t)0x00000004)
#define GPIO_BSRR_BS3 ((u32_t)0x00000008)
#define GPIO_BSRR_BS4 ((u32_t)0x00000010)
#define GPIO_BSRR_BS5 ((u32_t)0x00000020)
#define GPIO_BSRR_BS6 ((u32_t)0x00000040)
#define GPIO_BSRR_BS7 ((u32_t)0x00000080)
#define GPIO_BSRR_BS8 ((u32_t)0x00000100)
#define GPIO_BSRR_BS9 ((u32_t)0x00000200)
#define GPIO_BSRR_BS10 ((u32_t)0x00000400)
#define GPIO_BSRR_BS11 ((u32_t)0x00000800)
#define GPIO_BSRR_BS12 ((u32_t)0x00001000)
#define GPIO_BSRR_BS13 ((u32_t)0x00002000)
#define GPIO_BSRR_BS14 ((u32_t)0x00004000)
#define GPIO_BSRR_BS15 ((u32_t)0x00008000)
#define GPIO_BSRR_BR0 ((u32_t)0x00010000)
#define GPIO_BSRR_BR1 ((u32_t)0x00020000)
#define GPIO_BSRR_BR2 ((u32_t)0x00040000)
#define GPIO_BSRR_BR3 ((u32_t)0x00080000)
#define GPIO_BSRR_BR4 ((u32_t)0x00100000)
#define GPIO_BSRR_BR5 ((u32_t)0x00200000)
#define GPIO_BSRR_BR6 ((u32_t)0x00400000)
#define GPIO_BSRR_BR7 ((u32_t)0x00800000)
#define GPIO_BSRR_BR8 ((u32_t)0x01000000)
#define GPIO_BSRR_BR9 ((u32_t)0x02000000)
#define GPIO_BSRR_BR10 ((u32_t)0x04000000)
#define GPIO_BSRR_BR11 ((u32_t)0x08000000)
#define GPIO_BSRR_BR12 ((u32_t)0x10000000)
#define GPIO_BSRR_BR13 ((u32_t)0x20000000)
#define GPIO_BSRR_BR14 ((u32_t)0x40000000)
#define GPIO_BSRR_BR15 ((u32_t)0x80000000)

#define GPIO_IDR_IDR0 ((u32_t)0x00000001)
#define GPIO_IDR_IDR1 ((u32_t)0x00000002)
#define GPIO_IDR_IDR2 ((u32_t)0x00000004)
#define GPIO_IDR_IDR3 ((u32_t)0x00000008)
#define GPIO_IDR_IDR4 ((u32_t)0x00000010)
#define GPIO_IDR_IDR5 ((u32_t)0x00000020)
#define GPIO_IDR_IDR6 ((u32_t)0x00000040)
#define GPIO_IDR_IDR7 ((u32_t)0x00000080)
#define GPIO_IDR_IDR8 ((u32_t)0x00000100)
#define GPIO_IDR_IDR9 ((u32_t)0x00000200)
#define GPIO_IDR_IDR10 ((u32_t)0x00000400)
#define GPIO_IDR_IDR11 ((u32_t)0x00000800)
#define GPIO_IDR_IDR12 ((u32_t)0x00001000)
#define GPIO_IDR_IDR13 ((u32_t)0x00002000)
#define GPIO_IDR_IDR14 ((u32_t)0x00004000)
#define GPIO_IDR_IDR15 ((u32_t)0x00008000)

#define GPIO_LCKR_LCK0 ((u32_t)0x00000001)
#define GPIO_LCKR_LCK1 ((u32_t)0x00000002)
#define GPIO_LCKR_LCK2 ((u32_t)0x00000004)
#define GPIO_LCKR_LCK3 ((u32_t)0x00000008)
#define GPIO_LCKR_LCK4 ((u32_t)0x00000010)
#define GPIO_LCKR_LCK5 ((u32_t)0x00000020)
#define GPIO_LCKR_LCK6 ((u32_t)0x00000040)
#define GPIO_LCKR_LCK7 ((u32_t)0x00000080)
#define GPIO_LCKR_LCK8 ((u32_t)0x00000100)
#define GPIO_LCKR_LCK9 ((u32_t)0x00000200)
#define GPIO_LCKR_LCK10 ((u32_t)0x00000400)
#define GPIO_LCKR_LCK11 ((u32_t)0x00000800)
#define GPIO_LCKR_LCK12 ((u32_t)0x00001000)
#define GPIO_LCKR_LCK13 ((u32_t)0x00002000)
#define GPIO_LCKR_LCK14 ((u32_t)0x00004000)
#define GPIO_LCKR_LCK15 ((u32_t)0x00008000)
#define GPIO_LCKR_LCKK ((u32_t)0x00010000)

#define GPIO_MODER_MODER0 ((u32_t)0x00000003)
#define GPIO_MODER_MODER0_0 ((u32_t)0x00000001)
#define GPIO_MODER_MODER0_1 ((u32_t)0x00000002)
#define GPIO_MODER_MODER1 ((u32_t)0x0000000C)
#define GPIO_MODER_MODER1_0 ((u32_t)0x00000004)
#define GPIO_MODER_MODER1_1 ((u32_t)0x00000008)
#define GPIO_MODER_MODER2 ((u32_t)0x00000030)
#define GPIO_MODER_MODER2_0 ((u32_t)0x00000010)
#define GPIO_MODER_MODER2_1 ((u32_t)0x00000020)
#define GPIO_MODER_MODER3 ((u32_t)0x000000C0)
#define GPIO_MODER_MODER3_0 ((u32_t)0x00000040)
#define GPIO_MODER_MODER3_1 ((u32_t)0x00000080)
#define GPIO_MODER_MODER4 ((u32_t)0x00000300)
#define GPIO_MODER_MODER4_0 ((u32_t)0x00000100)
#define GPIO_MODER_MODER4_1 ((u32_t)0x00000200)
#define GPIO_MODER_MODER5 ((u32_t)0x00000C00)
#define GPIO_MODER_MODER5_0 ((u32_t)0x00000400)
#define GPIO_MODER_MODER5_1 ((u32_t)0x00000800)
#define GPIO_MODER_MODER6 ((u32_t)0x00003000)
#define GPIO_MODER_MODER6_0 ((u32_t)0x00001000)
#define GPIO_MODER_MODER6_1 ((u32_t)0x00002000)
#define GPIO_MODER_MODER7 ((u32_t)0x0000C000)
#define GPIO_MODER_MODER7_0 ((u32_t)0x00004000)
#define GPIO_MODER_MODER7_1 ((u32_t)0x00008000)
#define GPIO_MODER_MODER8 ((u32_t)0x00030000)
#define GPIO_MODER_MODER8_0 ((u32_t)0x00010000)
#define GPIO_MODER_MODER8_1 ((u32_t)0x00020000)
#define GPIO_MODER_MODER9 ((u32_t)0x000C0000)
#define GPIO_MODER_MODER9_0 ((u32_t)0x00040000)
#define GPIO_MODER_MODER9_1 ((u32_t)0x00080000)
#define GPIO_MODER_MODER10 ((u32_t)0x00300000)
#define GPIO_MODER_MODER10_0 ((u32_t)0x00100000)
#define GPIO_MODER_MODER10_1 ((u32_t)0x00200000)
#define GPIO_MODER_MODER11 ((u32_t)0x00C00000)
#define GPIO_MODER_MODER11_0 ((u32_t)0x00400000)
#define GPIO_MODER_MODER11_1 ((u32_t)0x00800000)
#define GPIO_MODER_MODER12 ((u32_t)0x03000000)
#define GPIO_MODER_MODER12_0 ((u32_t)0x01000000)
#define GPIO_MODER_MODER12_1 ((u32_t)0x02000000)
#define GPIO_MODER_MODER13 ((u32_t)0x0C000000)
#define GPIO_MODER_MODER13_0 ((u32_t)0x04000000)
#define GPIO_MODER_MODER13_1 ((u32_t)0x08000000)
#define GPIO_MODER_MODER14 ((u32_t)0x30000000)
#define GPIO_MODER_MODER14_0 ((u32_t)0x10000000)
#define GPIO_MODER_MODER14_1 ((u32_t)0x20000000)
#define GPIO_MODER_MODER15 ((u32_t)0xC0000000)
#define GPIO_MODER_MODER15_0 ((u32_t)0x40000000)
#define GPIO_MODER_MODER15_1 ((u32_t)0x80000000)

#define GPIO_MODER_GPI(pin) ((u32_t)0x00000000 << (2 * (pin)))
#define GPIO_MODER_GPO(pin) ((u32_t)0x00000001 << (2 * (pin)))
#define GPIO_MODER_AFO(pin) ((u32_t)0x00000002 << (2 * (pin)))
#define GPIO_MODER_ANA(pin) ((u32_t)0x00000003 << (2 * (pin)))

#define GPIO_ODR_ODR0 ((u32_t)0x00000001)
#define GPIO_ODR_ODR1 ((u32_t)0x00000002)
#define GPIO_ODR_ODR2 ((u32_t)0x00000004)
#define GPIO_ODR_ODR3 ((u32_t)0x00000008)
#define GPIO_ODR_ODR4 ((u32_t)0x00000010)
#define GPIO_ODR_ODR5 ((u32_t)0x00000020)
#define GPIO_ODR_ODR6 ((u32_t)0x00000040)
#define GPIO_ODR_ODR7 ((u32_t)0x00000080)
#define GPIO_ODR_ODR8 ((u32_t)0x00000100)
#define GPIO_ODR_ODR9 ((u32_t)0x00000200)
#define GPIO_ODR_ODR10 ((u32_t)0x00000400)
#define GPIO_ODR_ODR11 ((u32_t)0x00000800)
#define GPIO_ODR_ODR12 ((u32_t)0x00001000)
#define GPIO_ODR_ODR13 ((u32_t)0x00002000)
#define GPIO_ODR_ODR14 ((u32_t)0x00004000)
#define GPIO_ODR_ODR15 ((u32_t)0x00008000)

#define GPIO_OSPEEDR_OSPEEDR0 ((u32_t)0x00000003)
#define GPIO_OSPEEDR_OSPEEDR0_0 ((u32_t)0x00000001)
#define GPIO_OSPEEDR_OSPEEDR0_1 ((u32_t)0x00000002)
#define GPIO_OSPEEDR_OSPEEDR1 ((u32_t)0x0000000C)
#define GPIO_OSPEEDR_OSPEEDR1_0 ((u32_t)0x00000004)
#define GPIO_OSPEEDR_OSPEEDR1_1 ((u32_t)0x00000008)
#define GPIO_OSPEEDR_OSPEEDR2 ((u32_t)0x00000030)
#define GPIO_OSPEEDR_OSPEEDR2_0 ((u32_t)0x00000010)
#define GPIO_OSPEEDR_OSPEEDR2_1 ((u32_t)0x00000020)
#define GPIO_OSPEEDR_OSPEEDR3 ((u32_t)0x000000C0)
#define GPIO_OSPEEDR_OSPEEDR3_0 ((u32_t)0x00000040)
#define GPIO_OSPEEDR_OSPEEDR3_1 ((u32_t)0x00000080)
#define GPIO_OSPEEDR_OSPEEDR4 ((u32_t)0x00000300)
#define GPIO_OSPEEDR_OSPEEDR4_0 ((u32_t)0x00000100)
#define GPIO_OSPEEDR_OSPEEDR4_1 ((u32_t)0x00000200)
#define GPIO_OSPEEDR_OSPEEDR5 ((u32_t)0x00000C00)
#define GPIO_OSPEEDR_OSPEEDR5_0 ((u32_t)0x00000400)
#define GPIO_OSPEEDR_OSPEEDR5_1 ((u32_t)0x00000800)
#define GPIO_OSPEEDR_OSPEEDR6 ((u32_t)0x00003000)
#define GPIO_OSPEEDR_OSPEEDR6_0 ((u32_t)0x00001000)
#define GPIO_OSPEEDR_OSPEEDR6_1 ((u32_t)0x00002000)
#define GPIO_OSPEEDR_OSPEEDR7 ((u32_t)0x0000C000)
#define GPIO_OSPEEDR_OSPEEDR7_0 ((u32_t)0x00004000)
#define GPIO_OSPEEDR_OSPEEDR7_1 ((u32_t)0x00008000)
#define GPIO_OSPEEDR_OSPEEDR8 ((u32_t)0x00030000)
#define GPIO_OSPEEDR_OSPEEDR8_0 ((u32_t)0x00010000)
#define GPIO_OSPEEDR_OSPEEDR8_1 ((u32_t)0x00020000)
#define GPIO_OSPEEDR_OSPEEDR9 ((u32_t)0x000C0000)
#define GPIO_OSPEEDR_OSPEEDR9_0 ((u32_t)0x00040000)
#define GPIO_OSPEEDR_OSPEEDR9_1 ((u32_t)0x00080000)
#define GPIO_OSPEEDR_OSPEEDR10 ((u32_t)0x00300000)
#define GPIO_OSPEEDR_OSPEEDR10_0 ((u32_t)0x00100000)
#define GPIO_OSPEEDR_OSPEEDR10_1 ((u32_t)0x00200000)
#define GPIO_OSPEEDR_OSPEEDR11 ((u32_t)0x00C00000)
#define GPIO_OSPEEDR_OSPEEDR11_0 ((u32_t)0x00400000)
#define GPIO_OSPEEDR_OSPEEDR11_1 ((u32_t)0x00800000)
#define GPIO_OSPEEDR_OSPEEDR12 ((u32_t)0x03000000)
#define GPIO_OSPEEDR_OSPEEDR12_0 ((u32_t)0x01000000)
#define GPIO_OSPEEDR_OSPEEDR12_1 ((u32_t)0x02000000)
#define GPIO_OSPEEDR_OSPEEDR13 ((u32_t)0x0C000000)
#define GPIO_OSPEEDR_OSPEEDR13_0 ((u32_t)0x04000000)
#define GPIO_OSPEEDR_OSPEEDR13_1 ((u32_t)0x08000000)
#define GPIO_OSPEEDR_OSPEEDR14 ((u32_t)0x30000000)
#define GPIO_OSPEEDR_OSPEEDR14_0 ((u32_t)0x10000000)
#define GPIO_OSPEEDR_OSPEEDR14_1 ((u32_t)0x20000000)
#define GPIO_OSPEEDR_OSPEEDR15 ((u32_t)0xC0000000)
#define GPIO_OSPEEDR_OSPEEDR15_0 ((u32_t)0x40000000)
#define GPIO_OSPEEDR_OSPEEDR15_1 ((u32_t)0x80000000)

#define GPIO_OSPEEDR_LS(pin) ((u32_t)0x00000000 << (2 * (pin)))
#define GPIO_OSPEEDR_MS(pin) ((u32_t)0x00000001 << (2 * (pin)))
#define GPIO_OSPEEDR_HS(pin) ((u32_t)0x00000003 << (2 * (pin)))

#define GPIO_OTYPER_OT0 ((u32_t)0x00000001)
#define GPIO_OTYPER_OT1 ((u32_t)0x00000002)
#define GPIO_OTYPER_OT2 ((u32_t)0x00000004)
#define GPIO_OTYPER_OT3 ((u32_t)0x00000008)
#define GPIO_OTYPER_OT4 ((u32_t)0x00000010)
#define GPIO_OTYPER_OT5 ((u32_t)0x00000020)
#define GPIO_OTYPER_OT6 ((u32_t)0x00000040)
#define GPIO_OTYPER_OT7 ((u32_t)0x00000080)
#define GPIO_OTYPER_OT8 ((u32_t)0x00000100)
#define GPIO_OTYPER_OT9 ((u32_t)0x00000200)
#define GPIO_OTYPER_OT10 ((u32_t)0x00000400)
#define GPIO_OTYPER_OT11 ((u32_t)0x00000800)
#define GPIO_OTYPER_OT12 ((u32_t)0x00001000)
#define GPIO_OTYPER_OT13 ((u32_t)0x00002000)
#define GPIO_OTYPER_OT14 ((u32_t)0x00004000)
#define GPIO_OTYPER_OT15 ((u32_t)0x00008000)

#define GPIO_PUPDR_PUPDR0 ((u32_t)0x00000003)
#define GPIO_PUPDR_PUPDR0_0 ((u32_t)0x00000001)
#define GPIO_PUPDR_PUPDR0_1 ((u32_t)0x00000002)
#define GPIO_PUPDR_PUPDR1 ((u32_t)0x0000000C)
#define GPIO_PUPDR_PUPDR1_0 ((u32_t)0x00000004)
#define GPIO_PUPDR_PUPDR1_1 ((u32_t)0x00000008)
#define GPIO_PUPDR_PUPDR2 ((u32_t)0x00000030)
#define GPIO_PUPDR_PUPDR2_0 ((u32_t)0x00000010)
#define GPIO_PUPDR_PUPDR2_1 ((u32_t)0x00000020)
#define GPIO_PUPDR_PUPDR3 ((u32_t)0x000000C0)
#define GPIO_PUPDR_PUPDR3_0 ((u32_t)0x00000040)
#define GPIO_PUPDR_PUPDR3_1 ((u32_t)0x00000080)
#define GPIO_PUPDR_PUPDR4 ((u32_t)0x00000300)
#define GPIO_PUPDR_PUPDR4_0 ((u32_t)0x00000100)
#define GPIO_PUPDR_PUPDR4_1 ((u32_t)0x00000200)
#define GPIO_PUPDR_PUPDR5 ((u32_t)0x00000C00)
#define GPIO_PUPDR_PUPDR5_0 ((u32_t)0x00000400)
#define GPIO_PUPDR_PUPDR5_1 ((u32_t)0x00000800)
#define GPIO_PUPDR_PUPDR6 ((u32_t)0x00003000)
#define GPIO_PUPDR_PUPDR6_0 ((u32_t)0x00001000)
#define GPIO_PUPDR_PUPDR6_1 ((u32_t)0x00002000)
#define GPIO_PUPDR_PUPDR7 ((u32_t)0x0000C000)
#define GPIO_PUPDR_PUPDR7_0 ((u32_t)0x00004000)
#define GPIO_PUPDR_PUPDR7_1 ((u32_t)0x00008000)
#define GPIO_PUPDR_PUPDR8 ((u32_t)0x00030000)
#define GPIO_PUPDR_PUPDR8_0 ((u32_t)0x00010000)
#define GPIO_PUPDR_PUPDR8_1 ((u32_t)0x00020000)
#define GPIO_PUPDR_PUPDR9 ((u32_t)0x000C0000)
#define GPIO_PUPDR_PUPDR9_0 ((u32_t)0x00040000)
#define GPIO_PUPDR_PUPDR9_1 ((u32_t)0x00080000)
#define GPIO_PUPDR_PUPDR10 ((u32_t)0x00300000)
#define GPIO_PUPDR_PUPDR10_0 ((u32_t)0x00100000)
#define GPIO_PUPDR_PUPDR10_1 ((u32_t)0x00200000)
#define GPIO_PUPDR_PUPDR11 ((u32_t)0x00C00000)
#define GPIO_PUPDR_PUPDR11_0 ((u32_t)0x00400000)
#define GPIO_PUPDR_PUPDR11_1 ((u32_t)0x00800000)
#define GPIO_PUPDR_PUPDR12 ((u32_t)0x03000000)
#define GPIO_PUPDR_PUPDR12_0 ((u32_t)0x01000000)
#define GPIO_PUPDR_PUPDR12_1 ((u32_t)0x02000000)
#define GPIO_PUPDR_PUPDR13 ((u32_t)0x0C000000)
#define GPIO_PUPDR_PUPDR13_0 ((u32_t)0x04000000)
#define GPIO_PUPDR_PUPDR13_1 ((u32_t)0x08000000)
#define GPIO_PUPDR_PUPDR14 ((u32_t)0x30000000)
#define GPIO_PUPDR_PUPDR14_0 ((u32_t)0x10000000)
#define GPIO_PUPDR_PUPDR14_1 ((u32_t)0x20000000)
#define GPIO_PUPDR_PUPDR15 ((u32_t)0xC0000000)
#define GPIO_PUPDR_PUPDR15_0 ((u32_t)0x40000000)
#define GPIO_PUPDR_PUPDR15_1 ((u32_t)0x80000000)

#define GPIO_PUPDR_NO(pin) ((u32_t)0x00000000 << (2 * (pin)))
#define GPIO_PUPDR_PU(pin) ((u32_t)0x00000001 << (2 * (pin)))
#define GPIO_PUPDR_PD(pin) ((u32_t)0x00000002 << (2 * (pin)))

#endif
